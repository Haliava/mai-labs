# Оптимизация работы курсового проекта с использованием Redis

## Описание проекта

Проект представляет собой веб-приложение, состоящее из бэкенда на Node.js с Express и фронтенда. Данное решение описывает оптимизацию проекта путем внедрения Redis для работы с динамическими данными.

## Реализованная функциональность

### 1. Хранение токенов авторизации

- Токены JWT хранятся в Redis с настроенным TTL (время жизни)
- Настроено автоматическое удаление просроченных токенов
- Реализована возможность принудительного отзыва токенов при выходе из системы
- Токены связаны с сессиями пользователей

### 2. Управление сессиями пользователей

- Сессии хранятся в Redis с настроенным TTL
- Реализована возможность получения всех активных сессий пользователя
- Обеспечено автоматическое удаление просроченных сессий
- Отслеживаются данные о сессии (IP-адрес, User-Agent и т.д.)

### 3. Кэширование данных

Реализовано кэширование следующих данных:
- Данных пользователей
- Списков пользователей
- Фичефлагов и их настроек
- Фичефлагов по организациям

Настроено автоматическое инвалидирование кэша при изменении данных.

### 4. Система мгновенных оповещений через PubSub

Реализована система оповещений в реальном времени о:
- Изменениях статуса фичефлагов
- Создании/удалении фичефлагов
- Других критических событиях

## Обоснование выбора структур данных Redis

### 1. Для токенов и сессий (TTL ключи)

Используется простая структура ключ-значение с TTL. Это позволяет эффективно хранить данные с автоматическим удалением после истечения срока действия.

Примеры ключей:
- `auth:token:{userId}` - токен пользователя
- `auth:user:{token}` - обратное отображение токен -> userId
- `session:{sessionId}` - данные сессии

### 2. Для связи пользователя с сессиями (Sets)

Используется структура Sets для хранения всех активных сессий пользователя:
- `user:{userId}:sessions` - множество ID сессий пользователя

Это обеспечивает быстрый доступ ко всем сессиям пользователя O(1) и эффективное управление сессиями.

### 3. Для кэширования данных (JSON с TTL)

Данные хранятся в формате JSON с настроенным TTL для автоматического устаревания:
- `user:{id}` - данные пользователя
- `users:all` - список всех пользователей
- `feature-flag:{id}` - данные фичефлага
- `feature-flags:org:{orgId}` - фичефлаги организации

### 4. Для оповещений (PubSub каналы)

Используется механизм Redis PubSub для отправки и получения сообщений в реальном времени.

Каналы:
- `notifications:feature_flag_change` - изменения фичефлагов
- `notifications:user_activity` - активность пользователей
- `notifications:new_order` - новые заказы
- `notifications:order_status_change` - изменения статусов заказов

## Преимущества использования Redis

1. **Улучшение скорости работы системы**:
   - Снижение нагрузки на базу данных PostgreSQL
   - Ускорение операций чтения за счет кэширования
   - Мгновенный доступ к часто используемым данным

2. **Повышение безопасности**:
   - Надежное хранение токенов с возможностью их отзыва
   - Контроль сессий пользователей
   - Автоматическое удаление устаревших данных

3. **Улучшение масштабируемости**:
   - Снижение нагрузки на основную БД
   - Возможность горизонтального масштабирования
   - Отделение механизма кэширования от основного хранилища данных

4. **Улучшение пользовательского опыта**:
   - Более быстрые ответы API
   - Мгновенные уведомления о важных событиях
   - Более надежная авторизация

## Запуск проекта

1. Установите зависимости:
```bash
cd backend
npm install
```

2. Запустите Docker-контейнеры:
```bash
docker-compose up -d
```

3. Запустите сервер:
```bash
npm run dev
``` 